<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hjc.dao.RestaurantDao">

    <resultMap type="cn.hjc.entity.CookBook" id="cookResultMap">
        <id property="cookId" column="cook_id"/>
        <result property="cookName" column="cook_name"/>
        <result property="cookFlavor" column="cook_flavor"/>
        <result property="cookRepertory" column="cook_repertory"/>
        <result property="cookImage" column="cook_image"/>
        <result property="cookPrice" column="cook_price"/>
        <result property="cookType" column="cook_type"/>
        <result property="cookDesc" column="cook_desc"/>
        <result property="cookEnableStatus" column="cook_enable_status"/>
    </resultMap>

    <select id="getAllCookBook" resultType="CookBook" resultMap="cookResultMap">
        SELECT tb_cook_book.cook_id,
               tb_cook_book.cook_name,
               tb_cook_book.cook_flavor,
               tb_cook_book.cook_repertory,
               tb_cook_book.cook_image,
               tb_cook_book.cook_price,
               tb_cook_book.cook_type,
               tb_cook_book.cook_desc,
               tb_cook_book.cook_enable_status
        FROM tb_cook_book
        WHERE tb_cook_book.cook_enable_status > 0
    </select>

    <select id="getCookType" resultType="CookBook" resultMap="cookResultMap">
        SELECT tb_cook_book.cook_type
        FROM tb_cook_book
        WHERE cook_enable_status > 0
        GROUP BY tb_cook_book.cook_type
    </select>

    <update id="addToCart" parameterType="Cart">
        UPDATE tb_cart
        SET cook_id = #{cookId}
        WHERE user_id = #{userId}
          and cart_id = #{cartId}
    </update>

    <select id="getCart" parameterType="Cart" resultType="String">
        SELECT cook_id
        FROM tb_cart
        WHERE cart_id = #{cartId}
          AND user_id = #{userId}
    </select>

    <select id="getCartList" parameterType="int" resultType="CookBook" resultMap="cookResultMap">
        SELECT tb_cook_book.cook_id,
        tb_cook_book.cook_name,
        tb_cook_book.cook_flavor,
        tb_cook_book.cook_repertory,
        tb_cook_book.cook_price,
        tb_cook_book.cook_image,
        tb_cook_book.cook_type,
        tb_cook_book.cook_desc,
        tb_cook_book.cook_enable_status
        FROM tb_cook_book
        WHERE tb_cook_book.cook_enable_status > 0
        AND tb_cook_book.cook_id IN
        <foreach item="cookId" collection="array" open="(" separator="," close=")">
            #{cookId}
        </foreach>
    </select>

    <update id="submitOrder" parameterType="int">
        UPDATE tb_cook_book SET cook_repertory = cook_repertory - 1 WHERE cook_id IN
        <foreach item="cookId" collection="array" open="(" separator="," close=")">
            #{cookId}
        </foreach>
    </update>
</mapper>
    